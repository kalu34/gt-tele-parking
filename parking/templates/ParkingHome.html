{% extends 'include/ParkingBase.html' %} {% load static %} {% block content %}
<style>
  /* Optional: Add some styles for better presentation */
  .chart-container {
    width: 50%;
    margin: auto;
  }
  .container {
    padding: 10px;
  }
  .navigation_top{
    width: 100%;
  }
  @media(max-width: 576px){
    .chart-container{
      width: 100%;
    }
  }
</style>

<div class="container">
  {% if messages %} {% for message in messages %} {% if message.tags == 'success' %}
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <strong>Congratulations!</strong>
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
  {% elif message.tags == 'warning' %}
  <div class="alert alert-warning alert-dismissible fade show" role="alert">
    <strong>Warning!</strong>
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
  {% else %}
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <strong>Error!</strong>
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
  {% endif %} {% endfor %} {% endif %}
  <section class="cards">
    <div class="card_box bg_1">
      <div class="title">
        <div class="icon_box">
          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#fff" viewBox="0 0 480 512">
            <g class="nc-icon-wrapper" fill="#171717">
              <path
                d="M438.66 212.33l-11.24-28.1-19.93-49.83C390.38 91.63 349.57 64 303.5 64h-127c-46.06 0-86.88 27.63-103.99 70.4l-19.93 49.83-11.24 28.1C17.22 221.5 0 244.66 0 272v48c0 16.12 6.16 30.67 16 41.93V416c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32v-32h256v32c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32v-54.07c9.84-11.25 16-25.8 16-41.93v-48c0-27.34-17.22-50.5-41.34-59.67zm-306.73-54.16c7.29-18.22 24.94-30.17 44.57-30.17h127c19.63 0 37.28 11.95 44.57 30.17L368 208H112l19.93-49.83zM80 319.8c-19.2 0-32-12.76-32-31.9S60.8 256 80 256s48 28.71 48 47.85-28.8 15.95-48 15.95zm320 0c-19.2 0-48 3.19-48-15.95S380.8 256 400 256s32 12.76 32 31.9-12.8 31.9-32 31.9z"></path>
            </g>
          </svg>
        </div>
        <span>Spot</span>
      </div>
      <div class="body">
        <span>Spot Available Inside Your Parking System...</span>
      </div>
      <div class="value">{{parking.available_slots}}</div>
    </div>
    <div class="card_box bg_2">
      <div class="title">
        <div class="icon_box">
          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 448 512">
            <g class="nc-icon-wrapper" fill="#171717">
              <path
                d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path>
            </g>
          </svg>
        </div>
        <span>Clients</span>
      </div>
      <div class="body">
        <span>Client Count Inside Your Parking System...</span>
      </div>
      <div class="value">{{customer}}</div>
    </div>
    <div class="card_box bg_3">
      <div class="title">
        <div class="icon_box">
          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 640 512">
            <g class="nc-icon-wrapper" fill="#171717">
              <path
                d="M621.16 54.46C582.37 38.19 543.55 32 504.75 32c-123.17-.01-246.33 62.34-369.5 62.34-30.89 0-61.76-3.92-92.65-13.72-3.47-1.1-6.95-1.62-10.35-1.62C15.04 79 0 92.32 0 110.81v317.26c0 12.63 7.23 24.6 18.84 29.46C57.63 473.81 96.45 480 135.25 480c123.17 0 246.34-62.35 369.51-62.35 30.89 0 61.76 3.92 92.65 13.72 3.47 1.1 6.95 1.62 10.35 1.62 17.21 0 32.25-13.32 32.25-31.81V83.93c-.01-12.64-7.24-24.6-18.85-29.47zM48 132.22c20.12 5.04 41.12 7.57 62.72 8.93C104.84 170.54 79 192.69 48 192.69v-60.47zm0 285v-47.78c34.37 0 62.18 27.27 63.71 61.4-22.53-1.81-43.59-6.31-63.71-13.62zM320 352c-44.19 0-80-42.99-80-96 0-53.02 35.82-96 80-96s80 42.98 80 96c0 53.03-35.83 96-80 96zm272 27.78c-17.52-4.39-35.71-6.85-54.32-8.44 5.87-26.08 27.5-45.88 54.32-49.28v57.72zm0-236.11c-30.89-3.91-54.86-29.7-55.81-61.55 19.54 2.17 38.09 6.23 55.81 12.66v48.89z"></path>
            </g>
          </svg>
        </div>
        <span>Sales</span>
      </div>
      <div class="body">
        <span>Income Total Of Your Parking System...</span>
      </div>
      <div class="value">{{sale}}k</div>
    </div>
    <div class="card_box bg_4">
      <div class="title">
        <div class="icon_box">
          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 384 512">
            <g class="nc-icon-wrapper" fill="#171717">
              <path
                d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"></path>
            </g>
          </svg>
        </div>
        <span>Report</span>
      </div>
      <div class="body">
        <span>Report Made On Your Parking System...</span>
      </div>
      <div class="value">75+</div>
    </div>
  </section>
  <section class="data_visual">
    <div class="chart-container" style="font-family: poppins">
      <canvas id="myChart" width="400" height="250"></canvas>
    </div>
    <div class="setting">
      <div class="title">
        <span>Enviromental Settings</span>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512">
          <g class="nc-icon-wrapper" fill="#171717">
            <path
              d="M413.967,276.8c1.06-6.235,1.06-13.518,1.06-20.8s-1.06-13.518-1.06-20.8l44.667-34.318 c4.26-3.118,5.319-8.317,2.13-13.518L418.215,115.6c-2.129-4.164-8.507-6.235-12.767-4.164l-53.186,20.801 c-10.638-8.318-23.394-15.601-36.16-20.801l-7.448-55.117c-1.06-4.154-5.319-8.318-10.638-8.318h-85.098 c-5.318,0-9.577,4.164-10.637,8.318l-8.508,55.117c-12.767,5.2-24.464,12.482-36.171,20.801l-53.186-20.801 c-5.319-2.071-10.638,0-12.767,4.164l-42.549,71.765c-2.119,4.153-1.061,10.399,2.129,13.518L96.97,235.2 c0,7.282-1.06,13.518-1.06,20.8s1.06,13.518,1.06,20.8l-44.668,34.318c-4.26,3.118-5.318,8.317-2.13,13.518L92.721,396.4 c2.13,4.164,8.508,6.235,12.767,4.164l53.187-20.801c10.637,8.318,23.394,15.601,36.16,20.801l8.508,55.117 c1.069,5.2,5.318,8.318,10.637,8.318h85.098c5.319,0,9.578-4.164,10.638-8.318l8.518-55.117c12.757-5.2,24.464-12.482,36.16-20.801 l53.187,20.801c5.318,2.071,10.637,0,12.767-4.164l42.549-71.765c2.129-4.153,1.06-10.399-2.13-13.518L413.967,276.8z M255.468,328.8c-41.489,0-74.46-32.235-74.46-72.8s32.971-72.8,74.46-72.8s74.461,32.235,74.461,72.8S296.957,328.8,255.468,328.8 z"></path>
          </g>
        </svg>
      </div>
      <div class="setting_box">
        <div class="setting_title">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 1195 1195">
            <g class="nc-icon-wrapper" fill="#171717">
              <path
                d="M597.333 426.666c-94.293 0-170.667 76.373-170.667 170.667S503.04 768 597.333 768 768 691.627 768 597.333s-76.373-170.667-170.667-170.667zm381.44 128C959.146 376.746 817.92 235.519 640 215.893V128h-85.333v87.893C376.747 235.52 235.52 376.746 215.894 554.666h-87.893v85.333h87.893c19.627 177.92 160.853 319.147 338.773 338.773v87.893H640v-87.893c177.92-19.627 319.147-160.853 338.773-338.773h87.893v-85.333h-87.893zM597.333 896c-164.907 0-298.667-133.76-298.667-298.667s133.76-298.667 298.667-298.667S896 432.426 896 597.333 762.24 896 597.333 896z"></path>
            </g>
          </svg>
          <span>Set Location</span>
        </div>
        <span class="setting_p">
          Advanced Editing The Environmental Variable That Lead
          <br />
          To Formation Of Space …
        </span>
        <div class="setting_cta">
          <a href="{% url 'parking_data' %}" class="btn btn-outline text-white">Open Setting</a>
          <span>last Updated 2hr ago</span>
        </div>
      </div>
      <div class="setting_box">
        <div class="setting_title">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512">
            <g class="nc-icon-wrapper" fill="#171717">
              <path
                d="M416,64H257.6L76.5,251.6c-8,8-12.3,18.5-12.5,29c-0.3,11.3,3.9,22.6,12.5,31.2l123.7,123.6c8,8,20.8,12.5,28.8,12.5	s22.8-3.9,31.4-12.5L448,256V96L416,64z M385.3,166.7c-21.7,6.1-41.3-10-41.3-30.7c0-17.7,14.3-32,32-32c20.7,0,36.8,19.6,30.7,41.3	C403.8,155.6,395.6,163.8,385.3,166.7z"></path>
            </g>
          </svg>
          <span>Update Price Tag</span>
        </div>
        <span class="setting_p">
          Updating Price Tag So To Fit Customer Demand
          <br />
          To Formation Of Space …
        </span>
        <div class="setting_cta">
          <a href="{% url 'parking_data' %}" class="btn btn-outline text-white">Open Setting</a>
          <span>last Updated 5hr ago</span>
        </div>
      </div>
    </div>
  </section>
</div>

<script>
  // Get the canvas element

  document.addEventListener("DOMContentLoaded", function () {
    fetch("http://127.0.0.1:8000/api/report_income/week/")
      .then((response) => response.json())
      .then((data) => {
        // Prepare arrays for chart data
        const labels = Object.keys(data); // Get the dates as labels
        const customerData = labels.map((date) => data[date].total_value); // Get total values for each day
        const uniqueCustomerCount = labels.reduce((total, date) => total + data[date].total_customers, 0); // Total unique customers for the week
        const totalValue = customerData.reduce((total, value) => total + value, 0); // Total value for the week

        // Convert date strings to day names
        const dayNames = labels.map((date) => {
          const day = new Date(date).toLocaleString("en-US", { weekday: "short" }); // Get short day name
          return day.charAt(0).toUpperCase() + day.slice(1); // Capitalize the first letter
        });

        // Create the chart
        const ctx = document.getElementById("myChart").getContext("2d");
        const myChart = new Chart(ctx, {
          type: "line", // Specify the chart type
          data: {
            labels: dayNames, // Use the day names as labels
            datasets: [
              {
                label: "Total Income Of Each Day",
                data: customerData, // Use total values for the week
                borderColor: "#1976d2",
                borderWidth: 2,
                pointRadius: 3, // Optional: make points visible
                fill: true, // Enable filling under the line
                backgroundColor: "rgba(25, 118, 210, 0)", // Set background color under the line
              },
            ],
          },
          options: {
            maintainAspectRatio: false,
            title: {
              display: true,
              text: `Total Customers: ${uniqueCustomerCount}`, // Display total customers and value in the title
              fontFamily: "Poppins", // Set font to Poppins
            },
            scales: {
              xAxes: [
                {
                  gridLines: {
                    display: false,
                  },
                  ticks: {
                    fontFamily: "Poppins", // Set font to Poppins for x-axis ticks
                  },
                },
              ],
              yAxes: [
                {
                  gridLines: {
                    display: true, // Show grid lines for the y-axis
                  },
                  ticks: {
                    beginAtZero: true,
                    max: Math.max(...customerData) + 10, // Adjust max to accommodate the data
                    stepSize: Math.ceil(Math.max(...customerData) / 10), // Adjust step size for better visibility
                    fontFamily: "Poppins", // Set font to Poppins for y-axis ticks
                  },
                },
              ],
            },
            legend: {
              labels: {
                fontFamily: "Poppins", // Set font to Poppins for legend labels
              },
            },
          },
        });
      })
      .catch((error) => console.error("Error fetching data:", error));
  });
</script>

{% endblock %}
